{%extends"base.html" %}
{% from "macros/category.html" import category%}
{% from "macros/dealsCard.html" import Card%}
{% from "macros/nav.html" import nav%}
{%block seo%}

<title>Lowoncost</title>
<meta name="description" content="Find the lowest prices on the product you love with Lowoncost.">
<meta name="keywords" content="save money, Top deals from Ajio, Top deals from Amazon, Top deals from Flipkart, Top deals from Myntra, ajio offers">
<meta content="IN" name="country">
<link rel="stylesheet" href="{{url_for('static', filename='css/home.css')}}">
<link rel="stylesheet" href="{{url_for('static', filename='css/nav.css')}}">
<link rel="stylesheet" href="{{url_for('static', filename='css/footer.css')}}">

{%endblock%}

{%block content%}

{{nav(loggedin, userprofile, username)}}

<!-- #caliing category macro -->
{{category(username = False)}}

<div class="deals-header">
    <h3 class="section-header" style="margin: 0;">Latest Deals</h3>
</div>
{%if items==[]%}
<h3 style="text-align: center;">No deals found. Add new deal...</h3>
{%endif%}
<div class="deals-container" id="deals-container">
    {%for item in items %}
    <!-- Deal Cards -->
    {{Card(item, username, userprofile)}}
    {%endfor%}



</div>
{%if items |length >= 12%}
<button id="loadbut" class="load-more" onclick="loadmore()">
    <p>Load more...</p>
</button>
{%endif%}


{% include "footer.html"%}
<script>

    let loadbut = document.getElementById("loadbut")
    const path = window.location.pathname;
    const segments = path.split('/').filter(Boolean);
    let cat = segments[1]
    
    let page = 2
    if (cat == undefined) {
        cat = "all"
    }
    console.log(cat)
    async function loadmore() {
        
        const res = await fetch(`/homepage/${page}/${cat}`, {
            method: 'GET',
            headers: { 'Content-Type': 'application/json' }, // Set the content type
            
        });
        data = await res.text()
        //console.log(data)
        if (data !== "0") {
            let html = data
            
            let newsdiv = document.getElementById("deals-container")
            newsdiv.insertAdjacentHTML("beforeend", html)

        } else {
            loadbut.remove()
        }

        page++
    }

    function addShareEventListeners() {
        const shareBtns = document.querySelectorAll('.share-button');
        shareBtns.forEach(btn => {
            btn.addEventListener('click', function (e) {
                e.preventDefault();
                e.stopPropagation(); // Prevent the card click event from firing
                const url = this.dataset.url;
                if (navigator.share) {
                    navigator.share({
                        title: 'Check out this news!',
                        url: url
                    }).then(() => {
                        console.log('Thanks for sharing!');
                    }).catch(console.error);
                } else {
                    // Fallback for browsers that don't support the Web Share API
                    const tempInput = document.createElement('input');
                    document.body.appendChild(tempInput);
                    tempInput.value = `https://lowoncost.vercel.app${url}`;
                    tempInput.select();
                    document.execCommand('copy');
                    document.body.removeChild(tempInput);
                    alert('Link copied to clipboard!');
                }
            });
        });
    }


    addShareEventListeners()









   // document.querySelectorAll('.share-button').forEach(button => {
   //     button.addEventListener('click', function (e) {
   //         e.preventDefault();
    //        alert('Share this deal!');
    //    });
    //});

    // document.querySelectorAll('.btn').forEach(button => {
    //     button.addEventListener('click', function (e) {
    //         const action = this.textContent;
    //         alert(`${action} clicked!`);
    //     });
    // });

    // document.querySelectorAll('.category-btn').forEach(button => {
    //    button.addEventListener('click', function (e) {
    //       if (this.classList.contains('add-category-btn')) {
    //           const newCategory = prompt('Enter new category name:');
    //           if (newCategory) {
    //                const newButton = document.createElement('button');
    //                newButton.className = 'category-btn';
    //                newButton.textContent = newCategory;
    //               this.parentNode.insertBefore(newButton, this);
    //            }
    //         } else {
    //           alert(`Selected category: ${this.textContent}`);
    //       }
    //    });
    //});

    // document.querySelectorAll('.nav-icon').forEach(button => {
    //     button.addEventListener('click', function() {
    //         alert(`${this.textContent.trim()} clicked!`);
    //     });
    // });

    document.querySelectorAll('.stat-chip').forEach(chip => {
        chip.addEventListener('click', function () {
            alert(`${this.textContent.trim()} clicked!`);
        });
    });

    // document.querySelector('.add-deal-btn').addEventListener('click', function() {
    //     alert('Add new deal clicked!');
    // });
</script>

{%endblock%}